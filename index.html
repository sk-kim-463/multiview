<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>3 YouTube Views + Viewers + Live Chat</title>
  <style>
    :root {
      --gap: 12px;
      --chat-height: 420px;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, "Noto Sans KR", Arial, sans-serif; background:#0b0b0b; color:#eee; }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: var(--gap);
      padding: var(--gap);
    }

    .tile {
      background: #141414;
      border: 1px solid #232323;
      border-radius: 12px;
      overflow: hidden;
    }

    .video-container {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      background: #000;
    }
    .video-container iframe {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
    }

    /* 가운데 정렬 */
    .meta {
      padding: 10px 12px 6px 12px;
      text-align: center; /* ✅ 중앙 정렬 */
    }

    .name-line {
      font-weight: 700;
      color: #fff;
      white-space: nowrap;         /* 줄바꿈 방지 */
      overflow: hidden;
      text-overflow: ellipsis;     /* 너무 길면 … */
    }
    .name-line .count {
      font-weight: 700;
      color: #b7f397;
    }

    .chat {
      padding: 8px 12px 12px 12px;
    }
    .chat iframe {
      width: 100%;
      height: var(--chat-height);
      border: 1px solid #232323;
      border-radius: 8px;
      background: #0b0b0b;
    }
  </style>
</head>
<body>
  <div class="grid">
    <!-- 1 -->
    <div class="tile">
      <div class="video-container">
        <iframe
          id="video1"
          src="https://www.youtube.com/embed/NJUjU9ALj4A?autoplay=1&mute=1&rel=0"
          allow="autoplay; encrypted-media; picture-in-picture"
          allowfullscreen
          title="한국경제TV"
        ></iframe>
      </div>
      <div class="meta">
        <div class="name-line">한국경제TV: <span id="viewers1" class="count">0</span>명</div>
      </div>
      <div class="chat">
        <iframe id="chat1" title="한국경제TV 채팅"></iframe>
      </div>
    </div>

    <!-- 2 -->
    <div class="tile">
      <div class="video-container">
        <iframe
          id="video2"
          src="https://www.youtube.com/embed/lb1oB2feqkQ?autoplay=1&mute=1&rel=0"
          allow="autoplay; encrypted-media; picture-in-picture"
          allowfullscreen
          title="MTN"
        ></iframe>
      </div>
      <div class="meta">
        <div class="name-line">MTN: <span id="viewers2" class="count">0</span>명</div>
      </div>
      <div class="chat">
        <iframe id="chat2" title="MTN 채팅"></iframe>
      </div>
    </div>

    <!-- 3 -->
    <div class="tile">
      <div class="video-container">
        <iframe
          id="video3"
          src="https://www.youtube.com/embed/s9xL1DpBsfQ?autoplay=1&mute=1&rel=0"
          allow="autoplay; encrypted-media; picture-in-picture"
          allowfullscreen
          title="매일경제TV"
        ></iframe>
      </div>
      <div class="meta">
        <div class="name-line">매일경제TV: <span id="viewers3" class="count">0</span>명</div>
      </div>
      <div class="chat">
        <iframe id="chat3" title="매일경제TV 채팅"></iframe>
      </div>
    </div>
  </div>

  <script>
    const VIDEO_IDS = ['NJUjU9ALj4A','lb1oB2feqkQ','s9xL1DpBsfQ'];

    document.addEventListener("DOMContentLoaded", () => {
      const domain = location.hostname || 'localhost';
      const chatIframes = [
        document.getElementById('chat1'),
        document.getElementById('chat2'),
        document.getElementById('chat3'),
      ];
      VIDEO_IDS.forEach((vid, i) => {
        chatIframes[i].src = `https://www.youtube.com/live_chat?v=${vid}&embed_domain=${domain}&dark_theme=1`;
      });

      updateViewers();
      setInterval(updateViewers, 15000);
    });

    function updateViewers() {
      const endpoint =
        `https://www.googleapis.com/youtube/v3/videos?part=liveStreamingDetails&id=${VIDEO_IDS.join(',')}&key=AIzaSyB8u0gmJgBgGM9K1W-hF_q1GpOh8uwZw3w`;

      fetch(endpoint)
        .then(res => res.json())
        .then(data => {
          const map = {};
          (data.items || []).forEach(item => {
            const id = item.id;
            const v = item?.liveStreamingDetails?.concurrentViewers || 0;
            map[id] = Number(v);
          });

          VIDEO_IDS.forEach((vid, idx) => {
            const n = map[vid] || 0;
            const formatted = n.toLocaleString('ko-KR');
            const el = document.getElementById(`viewers${idx + 1}`);
            if (el) el.textContent = formatted;
          });
        })
        .catch(err => console.error('집계중:', err));
    }
  </script>
</body>
</html>
